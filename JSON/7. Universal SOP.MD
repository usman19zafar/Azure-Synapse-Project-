UNIVERSAL SOP — Multi‑Line JSON Ingestion (Serverless SQL)

Purpose

To define a consistent, repeatable method for ingesting multi‑line (classic) JSON files using Synapse Serverless SQL.

This SOP ensures correctness, performance, and predictable schema extraction.

Scope

Applies to any JSON file where:

JSON objects are grouped inside a single JSON array, and

The array spans multiple lines, and

The file is not line‑delimited JSON.

Example:

```Code
[
  { "id": 1, "desc": "A" },
  { "id": 2, "desc": "B" }
]
```

SOP Steps

Step 1 — Read the entire file as one JSON string
Override all delimiters so the CSV parser does not split the file.

```Code

FIELDTERMINATOR = '0x0b'
FIELDQUOTE     = '0x0b'
ROWTERMINATOR  = '0x0b'
```

Reason:
Vertical tab (0x0b) never appears in JSON → ensures the entire file loads as one row.

Step 2 — Load JSON into a single NVARCHAR(MAX) column

```sql
WITH (jsonDoc NVARCHAR(MAX))
```
This stores the entire JSON array in one column.

Step 3 — Use OPENJSON to explode the array

```sql
CROSS APPLY OPENJSON(jsonDoc)
WITH (
    <column1> <datatype>,
    <column2> <datatype>,
    ...
)
```
OPENJSON:

Detects the array

Returns one row per element

Maps JSON properties to SQL columns

Applies explicit data types

Step 4 — Select the final columns

```sql
SELECT <column1>, <column2>, ...
Full Template
sql
SELECT <column1>, <column2>, ...
FROM OPENROWSET(
        BULK '<folder>/<file>.json',
        DATA_SOURCE = '<data_source>',
        FORMAT = 'CSV',
        FIELDTERMINATOR = '0x0b',
        FIELDQUOTE     = '0x0b',
        ROWTERMINATOR  = '0x0b'
     )
WITH (jsonDoc NVARCHAR(MAX)) AS src
CROSS APPLY OPENJSON(jsonDoc)
WITH (
        <column1> <datatype>,
        <column2> <datatype>,
        ...
     );
```

Key Rules

Always override row terminator for multi‑line JSON.

Always use OPENJSON (never JSON_VALUE).

Always define explicit data types.

Always treat the entire file as one JSON document.

2. Comparison Table — Line‑Delimited vs Multi‑Line JSON

```Code
+------------------------+----------------------------+------------------------------+
| Feature                | Line‑Delimited JSON        | Multi‑Line (Classic) JSON    |
+------------------------+----------------------------+------------------------------+
| Structure              | One JSON per line          | One JSON array across lines  |
| Example                | {"a":1}{"a":2}             | [ {"a":1}, {"a":2} ]         |
| Row Terminator         | '\n' (default)             | Must override to '0x0b'      |
| How many rows read     | One per line               | Entire file = one row        |
| Parser behavior        | Safe to split by newline   | Newlines break JSON          |
| OPENROWSET behavior    | Reads multiple rows        | Reads one row                |
| Best extraction tool   | JSON_VALUE or OPENJSON     | OPENJSON only                |
| Array handling         | JSON_VALUE limited         | OPENJSON required            |
| Typical use cases      | Logs, telemetry, events    | Config files, reference data |
+------------------------+----------------------------+------------------------------+
```

3. JSON Ingestion Decision Tree (Flowchart)

Below is a clean ASCII flowchart you can paste directly into your workbook.

```Code
                           +-----------------------------+
                           |   Start JSON Ingestion      |
                           +--------------+--------------+
                                          |
                                          v
                         +----------------+----------------+
                         | Is the file line-delimited?     |
                         | (One JSON per line)             |
                         +----------------+----------------+
                                          | Yes
                                          v
                          +---------------+----------------+
                          | Use ROWTERMINATOR = '\n'       |
                          | Read one JSON per row          |
                          | Use JSON_VALUE or OPENJSON     |
                          +---------------+----------------+
                                          |
                                          v
                                      [Done]
                                          |
                                          |
                                          No
                                          v
                    +---------------------+----------------------+
                    | Is the file a classic multi-line JSON?     |
                    | (One JSON array spanning multiple lines)   |
                    +---------------------+----------------------+
                                          |
                                          v
                     +--------------------+----------------------+
                     | Override ROWTERMINATOR = '0x0b'           |
                     | Read entire file as one JSON string       |
                     | Use OPENJSON to explode the array         |
                     +--------------------+----------------------+
                                          |
                                          v
                                      [Done]

```
